path:
  /tasks/{id}/send-to-waiting:
    post:
      summary: タスクを確認待ちにする
      parameters:
        - $ref: "#/components/parameters/TaskId"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [waitingReason]
              properties:
                waitingReason:
                  type: string
      responses:
        "200":
          description: 確認待ちに遷移
          content:
            application/json:
              schema: 
                $ref: "#/components/schemas/TaskDetail"
        "400":
          description: waitingReasonが空
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "404":
          description: 指定されたidのタスクが存在しない
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "409":
          description: NORMAL以外からの遷移
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"


  /tasks/{id}/suspend:
    post:
      summary:  タスクを中断する
      parameters: 
        - $ref: "#/components/parameters/TaskId"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [progressNote]
              properties: 
                progressNote:
                  type: string
      responses:
        "200":
          description: 中断中に遷移
          content:
            application/json:
              schema: 
                $ref: "#/components/schemas/TaskDetail"
        "400":
          description: progressNoteが空
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "404":
          description: 指定されたidのタスクが存在しない
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "409":
          description: NORMAL以外からの遷移
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

  /tasks/{id}/resume:
    post: 
      summary: 中断を解除する
      parameters: 
        - $ref: "#/components/parameters/TaskId"
      responses:
        "200":
          description: "中断を解除する"
          content:
            application/json: 
              schema: 
                $ref: "#/components/schemas/TaskDetail"
        "404": 
          description: "指定されたidのタスクが存在しない"
          content: 
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "409": 
          description: "SUSPENDED以外からの遷移"
          content: 
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

  /tasks/{id}/approve:
    post:
      summary:  タスクを承認する
      parameters: 
        - $ref: "#/components/parameters/TaskId"
      responses:
        "200":
          description: タスクを承認、完了に遷移する
          content:
            application/json:
              schema: 
                $ref: "#/components/schemas/TaskDetail"
        "404":
          description: 指定されたidのタスクが存在しない
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "409":
          description: 状態不正または子タスク未完了
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
  
  /tasks/{id}/reject:
    post:
      summary:  タスクを差し戻す
      parameters: 
        - $ref: "#/components/parameters/TaskId"
      responses:
        "200":
          description: タスクを差し戻し、NORMALに遷移する
          content:
            application/json:
              schema: 
                $ref: "#/components/schemas/TaskDetail"
        "404":
          description: 指定されたidのタスクが存在しない
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "409":
          description: 状態が不正です
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

  /tasks/{id}/complete:
    post:
      summary:  タスクを完了する
      parameters: 
        - $ref: "#/components/parameters/TaskId"
      responses:
        "200":
          description: タスクを完了に遷移する
          content:
            application/json:
              schema: 
                $ref: "#/components/schemas/TaskDetail"
        "404":
          description: 指定されたidのタスクが存在しない
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "409":
          description: 状態不正または子タスク未完了
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
                    
components:
  schemas:
    ErrorResponse:
      type: object
      required: [code, message]
      properties:
        code:
          type: string
          enum: [VALIDATION_ERROR, INVALID_STATE, CHILDREN_INCOMPLETE, NOT_FOUND]
        message: 
          type: string
        details:
          type: object
          nullable: true
          description: >
            code=CHILDREN_INCOMPLETE の場合、details.incompleteChildren に未完了子タスクの配列（id/title/status）を入れる。その他は省略=フィールド自体を返さない。
      examples: 
        children_incomplete:
          value: 
            code: CHILDREN_INCOMPLETE
            message: 未完了の子タスクがあります。
            details: 
              incompleteChildren:
                - id: 11111111-1111-1111-1111-111111111111
                  title: 子タスクA
                  status: NORMAL
        invalid_state:
          value: 
            code: INVALID_STATE
            message: 状態が不正です。